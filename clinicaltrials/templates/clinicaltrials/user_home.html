{% extends 'clinicaltrials/base.html' %}
{% load staticfiles %}
<!-- <link rel="stylesheet" type = "text/css" href="{% static 'clinicaltrials/style.css' %}"/> -->

{% block body %}

<!-- <div id="user-title"><h1> {{user}}'s Received Files</h1></div> -->
<div id="user-title"><h2> Received Files</h2></div>
<br>
{% ifequal ownedFiles.count 0 %}
	<h4> no files received</h4>
{% else %}
	{% for file in ownedFiles %}
		<ul>
			<h3> {{file.filename}} uploaded: {{file.uploadDate}} from: {{file.sender}} </h3> 
			<a href="{% url 'clinicaltrial:download' file.data.path %}"> Download </a>
			<br>
		</ul>
	{% endfor %}
{% endifequal %}

<br>
<br>



<!-- <h1> {{user}}'s Blockchain Ledger</h1> -->

<div id="block-title"><h2>Blockchain Ledger</h2></div>
<h4 id = "passing">{{validityMessage}}</h4>
<!-- <h3> validity: {{validity}} </h3> -->
<!--Table--> 
<table class="table table-hover">
    <thead class="blue-grey lighten-4">
        <tr>
            <th>Block Index</th>
            <th>Time Stamp</th>
            <th>Sender</th>
            <th>Receiver</th>
            <th>File</th>
            <th>Previous Block Hash</th>   
            <th>Block Hash</th>


        </tr>
    </thead>
    <tbody>
    	{% for block in blocks %}
    		{% if block.index == 1 %}
    		<tr> 
    			<th scope="row">{{block.index}}</th>
	            <td>{{block.timeStamp}}</td>
	            <td> -- </td>
	            <td> -- </td>
	            <td>genesis block</td>
	            <td> -- </td>
	            <td>{{block.hashString}}</td>
    		</tr>
    		{% else %}
	        <tr>
	            <th scope="row">{{block.index}}</th>
	            <td>{{block.timeStamp}}</td>
	            <td>{{block.fileReference.sender}}</td>
	            <td>{{block.fileReference.owner}}</td>
	            
	            <td> <a href="{% url 'clinicaltrial:download' block.fileReference.data.path  %}"> {{block.fileReference.filename}} </a> 
	            
	            {% if block.fileReference.encrypted %}
	            	<form action="{% url 'clinicaltrial:decryptdownload' block.fileReference.data.path  %}" method="post">
						{% csrf_token %}
						<input type="text" name="decryptpassword" value="">
						<br>
						<input type="submit" value="download decrypted file">
					</form>
				
	            {% endif %}
				</td>

	            <td>{{block.previousHash}}</td>
	            <td>{{block.hashString}}</td>
	        </tr>
    		{% endif %}

		{% endfor %}
    </tbody>
</table>

{% endblock %}
